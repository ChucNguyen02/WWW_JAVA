<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="layout/base :: head"></head>
<body>
  <div th:replace="layout/base :: content" th:with="contentFragment=${{content: 'content'}}">
    <div th:fragment="content">
      <h2>Giỏ hàng</h2>

      <div th:if="${#lists.isEmpty(cartItems)}">
        <p>Giỏ hàng trống. <a th:href="@{/products}">Tiếp tục mua sắm</a></p>
      </div>

      <div th:unless="${#lists.isEmpty(cartItems)}">
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr><th>Sản phẩm</th><th>Đơn giá</th><th>Số lượng</th><th>Thành tiền</th><th></th></tr>
            </thead>
            <tbody>
              <tr th:each="item : ${cartItems}">
                <td>
                  <strong th:text="${item.product.name}">Name</strong>
                  <div class="text-muted small" th:text="${item.product.category.name}">Category</div>
                </td>
                <td th:text="${#numbers.formatDecimal(item.product.price,1,2)}">0.00</td>
                <td>
                  <form th:action="@{/cart/update}" method="post" class="d-flex">
                    <input type="hidden" name="cartItemId" th:value="${item.id}"/>
                    <input type="hidden" name="productId" th:value="${item.product.id}"/>
                    <input class="form-control form-control-sm me-2" style="width:90px" type="number" name="quantity" th:value="${item.quantity}" min="0"/>
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button class="btn btn-sm btn-outline-secondary" type="submit">Cập nhật</button>
                  </form>
                </td>
                <td th:text="${#numbers.formatDecimal(item.subtotal,1,2)}">0.00</td>
                <td><a class="btn btn-sm btn-danger" th:href="@{/cart/remove/{itemId}(itemId=${item.id}, productId=${item.product.id})}">Xóa</a></td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="d-flex justify-content-between align-items-center">
          <h4>Total: <span th:text="${#numbers.formatDecimal(cartTotal,1,2)}">0.00</span></h4>
          <div>
            <a class="btn btn-outline-danger me-2" th:href="@{/cart/clear}">Xóa giỏ</a>
            <a class="btn btn-success" sec:authorize="hasRole('USER')" th:href="@{/user/checkout}">Thanh toán</a>
            <a class="btn btn-primary" sec:authorize="isAnonymous()" th:href="@{/login}">Đăng nhập để thanh toán</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>